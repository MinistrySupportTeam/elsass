$layout: (
    s: (
        device-min-width: 1px,
        content-max-width: 480px,
        width-divisor: 12,
        horizontal-spacing: 15px,
        vertical-spacing: 10px
    ),
    m: (
        device-min-width: 640px,
        content-max-width: 690px,
        width-divisor: 12,
        horizontal-spacing: 20px,
        vertical-spacing: 15px
    ),
    l: (
        device-min-width: 1024px,
        content-max-width: 1000px,
        width-divisor: 12,
        horizontal-spacing: 25px,
        vertical-spacing: 20px
    ),
    xl: (
        device-min-width: 1366px,
        content-max-width: 1280px,
        width-divisor: 12,
        horizontal-spacing: 30px,
        vertical-spacing: 25px
    )
);

@mixin breakpoint($min-width: null, $max-width: null) {
    @if $min-width and $max-width {
        @media screen and (min-width: $min-width) and (max-width: calc(#{$max-width} - 1px)) {
            @content;
        }
    } @else if $min-width {
        @media screen and (min-width: $min-width) {
            @content;
        }
    } @else if $max-width {
        @media screen and (max-width: $max-width) {
            @content;
        }
    } @else {
        @content;
    }
}

@mixin oui($media: null, $col-width: null, $margin: null, $paddings: null, $is-container: null) {

    // Get media related variables.
    $medias: map-keys($layout);
    $from-media: null;
    $min-width: null;
    $max-width: null;

    @if $media {
        $from-media: map-get($layout, nth($media, 1));
        $min-width: map-get($from-media, device-min-width);
        @if type-of($media) == list {
            $to-media: map-get($layout, nth($media, 2));
            $max-width: map-get($to-media, device-min-width);
        }
    } @else {
        $from-media: map-get($layout, nth($medias, 1));
    }

    // Build margin related variables.
    $horizontal-spacing: null;
    $vertical-spacing: null;
    $calc-margins: 0;

    @if $margin {
        $horizontal-spacing: map-get($from-media, horizontal-spacing);
        $vertical-spacing: map-get($from-media, vertical-spacing);

        @if type-of($margin) == list {
            @if length($margin) == 2 and nth($margin, 1) != nth($margin, 2) {
                $margin: nth($margin, 1) nth($margin, 2) nth($margin, 1) nth($margin, 2);
            } @else if length($margin) == 4 and nth($margin, 1) != (nth($margin, 2) or nth($margin, 3) or nth($margin, 4)) {
                $margin: nth($margin, 1) nth($margin, 2) nth($margin, 3) nth($margin, 4);
            }
        } @else {
            $margin: nth($margin, 1) nth($margin, 1) nth($margin, 1) nth($margin, 1)
        }
        @each $value in (nth($margin, 2), nth($margin, 4)) {
            @if $value == true {
                $calc-margins: $calc-margins + 1;
            }
        }
    }

    // Generate css
    $values-order: "top", "right", "bottom", "left";

    @include breakpoint($min-width, $max-width) {

        @if $is-container {
            display: flex;
            flex-wrap: wrap;
            @if not $col-width {
                $max-width: map-get($from-media, content-max-width);
                max-width: $max-width;
            }
        }

        // Generate css width.
        @if $col-width {
            @if $margin {
                width: calc(#{$col-width} * 100% - #{$calc-margins} * #{$horizontal-spacing});
            } @else {
                width: $col-width * 100%;
            }
        }

        // Generate css margin.
        $index: 1;
        @each $value in $margin {

            @if $value == true {
                $value: if($index == 2 or $index == 4, $horizontal-spacing, $vertical-spacing);
                margin-#{nth($values-order, $index)}: $value;
            } @else if $value == auto {
                margin-#{nth($values-order, $index)}: $value;
            }
            $index: $index + 1;
        }

        @content;
    }

    // Add missing medias.
    $from-index: 1;
    $to-index: length($medias);

    @if $media {
        $from-index: index($medias, nth($media, 1)) + 1;

        @if type-of($media) == list {
            $to-index: index($medias, nth($media, 2)) - 1;
        }
    }

    @if $to-index - $from-index >= 0 {
        @for $index from $from-index through $to-index {
            $media: map-get($layout, nth($medias, $index));
            $min-width: map-get($media, device-min-width);
            $horizontal-spacing: map-get($media, horizontal-spacing);
            $vertical-spacing: map-get($media, vertical-spacing);
            $content-max-width: map-get($media, content-max-width);

            @if $index != length($medias) {
                $to-media: map-get($layout, nth($medias, ($index + 1)));
                $max-width: map-get($to-media, device-min-width);
            } @else {
                $max-width: null;
            }

            @include breakpoint($min-width, $max-width) {
                // Generate css margin.
                @if $is-container {
                    @if not $col-width {
                        max-width: $content-max-width;
                    }
                }
                @if $margin {
                    // Generate css margin.
                    $index: 1;
                    @each $value in $margin {
                        @if $value == true {
                            $value: if($index == 2 or $index == 4, $horizontal-spacing, $vertical-spacing);
                            margin-#{nth($values-order, $index)}: $value;
                        } @else if $value == auto {
                            margin-#{nth($values-order, $index)}: $value;
                        }
                        $index: $index + 1;
                    }
                }
            }
        }
    }
}

.agrid {
    @include oui("s" "xl", 1/2, true, $is-container: true) {
        border: 1px solid #ccc;
    };
}
